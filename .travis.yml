language: python
cache:
  directories:
  - $HOME/.cache/pip
  - $HOME/.nvm
  - node_modules
  - wger/node_modules
sudo: false
python:
- '2.7'
- '3.4'
- '3.5'
env:
- TEST_MOBILE=True  DB=postgresql TRAVIS_NODE_VERSION="4"
- TEST_MOBILE=True  DB=sqlite     TRAVIS_NODE_VERSION="4"
- TEST_MOBILE=False DB=postgresql TRAVIS_NODE_VERSION="4"
- TEST_MOBILE=False DB=sqlite     TRAVIS_NODE_VERSION="4"
install:
- curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.4/install.sh | METHOD=script
  bash
- . $HOME/.nvm/nvm.sh
- nvm install $TRAVIS_NODE_VERSION
- nvm use $TRAVIS_NODE_VERSION
- pip install -r requirements_devel.txt
- npm install
- if [[ "$DB" = "postgresql" ]]; then pip install psycopg2; fi
- if [[ "$DB" = "sqlite" ]]; then invoke create_settings; fi
- if [[ "$DB" = "postgresql" ]]; then invoke create_settings --database-type postgresql;
  fi
before_script:
- if [[ "$DB" = "postgresq" ]]; then psql -c 'DROP DATABASE IF EXISTS test_wger;'
  -U postgres; fi
- if [[ "$DB" = "postgresql" ]]; then psql -c 'CREATE DATABASE test_wger;' -U postgres;
  fi
script:
- pep8 wger
- gulp lint
- coverage run --source='.' ./manage.py test
- coverage report
notifications:
  slack:
    secure: aM3NWmnlSdVHizhqt+k/CBKioLs14zgivqeKvi1o5wdInvBX4WD3mByYeMMHcBBV7MYi/rY+DDUs2bmj9C7iv2SFNWbL5CarRn46gCf3eFEWtoNYG0ENudpn7yxD2bqC88z6cXNVDaR+7V9z9AQRomUTB8+Gdl3V89FaOdB3bSXqx09KlDyos0oDcmMD/f7Qxil/edevo6UU9Qh5ftVgoBMPnpmX+WhjnleW3ac5AIaUjwSFRAGRrJeOC0eZD3kLRKaOhPbcU6EHnAMnSeJzKpUeO8TIYp9phrcgxWevcYG/yZPhvntf/4j4q1LgSWtSpco4JoouKCwfDfa9wELU+P/KLhNQWQzU2MfScq+YNzhmL/NQunZVWgOMhSiLW83Yw+N0gMGfOa9AoAD3rAxIeNhEM5hk87n9mxqG0lFSbDpQ/M3wAwFET7xQuCvwWnV5uCgUrQTCIAifz76DrH5oXIv6fdweYGcSAO8Lyc6XgIpjz192iJ4F+FJqLgYceVPdPYv+N/ALpZe+u/P7kfmCk59Tbvc8/+rsK9/xLCxoefTjOL10Wem8qjL73OxyA/tHD6jVbawwu5ziVTezkzTWkEV8KKBI0XNcw+LWGDkkHsfZ627yxgJ++pGpWKgrCc2OjbRQqfi9RfyFpGPfyJpxO72nAo/dTl/xeWQQTX/eKTU=
